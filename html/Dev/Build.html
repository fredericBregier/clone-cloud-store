<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>8.2. Full Build on local &#8212; Clone Cloud Store [CCS] 0.8 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=472322c9" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <script src="../_static/documentation_options.js?v=f82dc3d9"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8.3. Using fake Streams in tests" href="Stream.html" />
    <link rel="prev" title="8.1. POM Version management" href="POM.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Architecture/index.html">1. Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Accessor/index.html">2. Accessor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Replicator/index.html">3. Replicator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reconciliator/index.html">4. Reconciliator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administration/index.html">5. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">6. Object Storage Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common/index.html">7. Commons</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">8. Dev Detail</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="POM.html">8.1. POM Version management</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8.2. Full Build on local</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-integrate-containers-in-quarkus-tests">8.2.1. How to integrate Containers in Quarkus tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#properties">8.2.1.1. Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handling-startup-of-containers">8.2.1.2. Handling startup of containers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#use-quarkustestresourcelifecyclemanager-and-quarkustestprofile">8.2.1.2.1. Use QuarkusTestResourceLifecycleManager and QuarkusTestProfile</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Stream.html">8.3. Using fake Streams in tests</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html"><span class="section-number">8. </span>Dev Detail</a><ul>
      <li>Previous: <a href="POM.html" title="previous chapter"><span class="section-number">8.1. </span>POM Version management</a></li>
      <li>Next: <a href="Stream.html" title="next chapter"><span class="section-number">8.3. </span>Using fake Streams in tests</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="full-build-on-local">
<h1><span class="section-number">8.2. </span>Full Build on local<a class="headerlink" href="#full-build-on-local" title="Link to this heading">¶</a></h1>
<p>Use the <code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">benchmark</span></code> to allow to run benchmark tests, place in IT tests.</p>
<p>Note that current implementation changes most of other real IT tests to ITTest tests,
such that they are launched event without this profile <code class="docutils literal notranslate"><span class="pre">benchmark</span></code>.
The main reasons are:
- Most of those tests are really “simple” IT tests, meaning they are part of Junit tests.
- Aggregation of coverage is easier for those non IT tests</p>
<p>In the same idea, if the CI/CD does support the Sphinx process to build the HTML and PDF documentations, the profile
<code class="docutils literal notranslate"><span class="pre">-P</span> <span class="pre">doc</span></code> can be included.</p>
<p>In order to launch them locally, you have to do the following:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Example for <strong>maven with Doc generation</strong></span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mvn<span class="w"> </span>verify
mvn<span class="w"> </span>package<span class="w"> </span>-P<span class="w"> </span>doc
</pre></div>
</div>
</div>
<p>You can launch only with container (implying all tests plus the one that are using IT name but QuarkusTest,
not QuarkusIntegrationTest), using only <strong>verify</strong> phase.</p>
<p>You can launch only documentation generation, using <strong>package</strong> phase (documentation is build on pre-package phase).</p>
<section id="how-to-integrate-containers-in-quarkus-tests">
<h2><span class="section-number">8.2.1. </span>How to integrate Containers in Quarkus tests<a class="headerlink" href="#how-to-integrate-containers-in-quarkus-tests" title="Link to this heading">¶</a></h2>
<p>By default, if any dependencies use containers for testing (Quarkus Dev Support), it will be launch on each and every
tests. Most of the time, that is not an issue, but in some cases we do want to control when a container is
launched or not.</p>
<p>Moreover, if multiple “containers” are defined in the dependencies, they will all be launched for each and every
tests, even if not needed.</p>
<p>So the following is an option to remove those constraints and still being able to launch tests with or without
explicit container(s).</p>
<p><strong>Of course, if using default Dev services from Quarkus is not an issue, you can still rely on it and therefore ignore
the following.</strong></p>
<p>Full examples are available within ccs-test-support test sources.</p>
<section id="properties">
<h3><span class="section-number">8.2.1.1. </span>Properties<a class="headerlink" href="#properties" title="Link to this heading">¶</a></h3>
<p>Add the following to your application.properties for test (in <code class="docutils literal notranslate"><span class="pre">src/test/resources</span></code>):</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Example for <strong>properties</strong> for Dev Containers</span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># Global stop (needed to prevent Ryuk to be launched)</span>
<span class="na">quarkus.devservices.enabled</span><span class="o">=</span><span class="s">false</span>
<span class="c1"># Below according to what is used in the tests</span>
<span class="c1"># Particular stop for S3</span>
<span class="na">quarkus.s3.devservices.enabled</span><span class="o">=</span><span class="s">false</span>
<span class="c1"># Particular stop for database (when not using PostgreSQL but MongoDB, set to true if reversed)</span>
<span class="na">quarkus.hibernate-orm.enabled</span><span class="o">=</span><span class="s">false</span>
<span class="c1">#DO NOT SET THIS: quarkus.hibernate-orm.database.generation = drop-and-create</span>
</pre></div>
</div>
</div>
</section>
<section id="handling-startup-of-containers">
<h3><span class="section-number">8.2.1.2. </span>Handling startup of containers<a class="headerlink" href="#handling-startup-of-containers" title="Link to this heading">¶</a></h3>
<p>The idea is to launch the container as needed and only when needed.</p>
<p>The following example is for S3.</p>
<section id="use-quarkustestresourcelifecyclemanager-and-quarkustestprofile">
<h4><span class="section-number">8.2.1.2.1. </span>Use QuarkusTestResourceLifecycleManager and QuarkusTestProfile<a class="headerlink" href="#use-quarkustestresourcelifecyclemanager-and-quarkustestprofile" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">QuarkusTestResourceLifecycleManager</span></code> is intended to provide manual control on resources needed before the Quarkus
test startups. (see Quarkus TESTING YOUR APPLICATION / Starting services before the Quarkus application starts
<a class="reference external" href="https://quarkus.io/guides/getting-started-testing#quarkus-test-resource">https://quarkus.io/guides/getting-started-testing#quarkus-test-resource</a> )</p>
<p>2 kinds of <code class="docutils literal notranslate"><span class="pre">QuarkusTestResourceLifecycleManager</span></code> can be done.</p>
<section id="for-no-container-at-all">
<h5><span class="section-number">8.2.1.2.1.1. </span>For no container at all<a class="headerlink" href="#for-no-container-at-all" title="Link to this heading">¶</a></h5>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Example for <strong>NoResource</strong> for no container</span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NoResource</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">QuarkusTestResourceLifecycleManager</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">SingletonUtils</span><span class="p">.</span><span class="na">singletonMap</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Nothing</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="for-a-real-container">
<h5><span class="section-number">8.2.1.2.1.2. </span>For a real container<a class="headerlink" href="#for-a-real-container" title="Link to this heading">¶</a></h5>
<p>2 classes are needed, one for the Resource, one for the Container using TestContainers.</p>
<p>The first one defines the Resource to be used and launched before Quarkus starts (mandatory).</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Example for <strong>MinioResource</strong> for Minio S3 container</span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MinIoResource</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">QuarkusTestResourceLifecycleManager</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">ACCESS_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;accessKey&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">SECRET_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;secretKey&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MinioContainer</span><span class="w"> </span><span class="n">minioContainer</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="k">new</span><span class="w"> </span><span class="n">MinioContainer</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MinioContainer</span><span class="p">.</span><span class="na">CredentialsProvider</span><span class="p">(</span><span class="n">ACCESS_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">SECRET_KEY</span><span class="p">));</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAccessKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">minioContainer</span><span class="p">.</span><span class="na">getAccessKey</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getSecretKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">minioContainer</span><span class="p">.</span><span class="na">getSecretKey</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getUrlString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">minioContainer</span><span class="p">.</span><span class="na">getUrlString</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getRegion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Regions</span><span class="p">.</span><span class="na">EU_WEST_1</span><span class="p">.</span><span class="na">name</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">minioContainer</span><span class="p">.</span><span class="na">isRunning</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">minioContainer</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">minioContainer</span><span class="p">.</span><span class="na">getEnvMap</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">minioContainer</span><span class="p">.</span><span class="na">stop</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The second one defines the container to start (using here TestContainers).</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Example for <strong>MinioContainer</strong> for Minio S3 container</span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MinioContainer</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">GenericContainer</span><span class="o">&lt;</span><span class="n">MinioContainer</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEFAULT_PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9000</span><span class="p">;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_IMAGE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;minio/minio&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">MINIO_ACCESS_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MINIO_ACCESS_KEY&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">MINIO_SECRET_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MINIO_SECRET_KEY&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DEFAULT_STORAGE_DIRECTORY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/data&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">HEALTH_ENDPOINT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/minio/health/ready&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">MinioContainer</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">CredentialsProvider</span><span class="w"> </span><span class="n">credentials</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">(</span><span class="n">DEFAULT_IMAGE</span><span class="p">,</span><span class="w"> </span><span class="n">credentials</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">MinioContainer</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CredentialsProvider</span><span class="w"> </span><span class="n">credentials</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">super</span><span class="p">(</span><span class="n">image</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">DEFAULT_IMAGE</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">image</span><span class="p">);</span>
<span class="w">    </span><span class="n">withNetworkAliases</span><span class="p">(</span><span class="s">&quot;minio-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Base58</span><span class="p">.</span><span class="na">randomString</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>
<span class="w">    </span><span class="n">withExposedPorts</span><span class="p">(</span><span class="n">DEFAULT_PORT</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">credentials</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">withEnv</span><span class="p">(</span><span class="n">MINIO_ACCESS_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">credentials</span><span class="p">.</span><span class="na">getAccessKey</span><span class="p">());</span>
<span class="w">      </span><span class="n">withEnv</span><span class="p">(</span><span class="n">MINIO_SECRET_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">credentials</span><span class="p">.</span><span class="na">getSecretKey</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">withCommand</span><span class="p">(</span><span class="s">&quot;server&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DEFAULT_STORAGE_DIRECTORY</span><span class="p">);</span>
<span class="w">    </span><span class="n">setWaitStrategy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HttpWaitStrategy</span><span class="p">().</span><span class="na">forPort</span><span class="p">(</span><span class="n">DEFAULT_PORT</span><span class="p">).</span><span class="na">forPath</span><span class="p">(</span><span class="n">HEALTH_ENDPOINT</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withStartupTimeout</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMinutes</span><span class="p">(</span><span class="mi">2</span><span class="p">)));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="nf">getURL</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">MalformedURLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">getUrlString</span><span class="p">());</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getUrlString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;http://&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getHost</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getMappedPort</span><span class="p">(</span><span class="n">DEFAULT_PORT</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAccessKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">getEnvMap</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="n">MINIO_ACCESS_KEY</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getSecretKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">getEnvMap</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="n">MINIO_SECRET_KEY</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CredentialsProvider</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accessKey</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">secretKey</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">CredentialsProvider</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accessKey</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">secretKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">accessKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accessKey</span><span class="p">;</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">secretKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">secretKey</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAccessKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">accessKey</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getSecretKey</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">secretKey</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="quarkustestprofile">
<h5><span class="section-number">8.2.1.2.1.3. </span>QuarkusTestProfile<a class="headerlink" href="#quarkustestprofile" title="Link to this heading">¶</a></h5>
<p>Once build, the recommended way is to use a QuarkusTestProfile.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Example for <strong>NoResourceProfile</strong> for no Dev services</span><a class="headerlink" href="#id6" title="Link to this code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NoResourceProfile</span><span class="w">  </span><span class="kd">implements</span><span class="w"> </span><span class="n">QuarkusTestProfile</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getConfigOverrides</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">ResourcesConstants</span><span class="p">.</span><span class="na">QUARKUS_DEVSERVICES_ENABLED</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">disableGlobalTestResources</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getConfigProfile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;test-noresource&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Example for <strong>MinioProfile</strong> for Minio S3 container</span><a class="headerlink" href="#id7" title="Link to this code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MinioProfile</span><span class="w">  </span><span class="kd">implements</span><span class="w"> </span><span class="n">QuarkusTestProfile</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getConfigOverrides</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">ResourcesConstants</span><span class="p">.</span><span class="na">QUARKUS_DEVSERVICES_ENABLED</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">disableGlobalTestResources</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getConfigProfile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;test-minio&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">TestResourceEntry</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">testResources</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TestResourceEntry</span><span class="p">(</span><span class="n">MinIoResource</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p><strong>Special attention on Database support</strong>: In order to be able to choose between PostgreSql implementation or MongoDB
implementation at runtime, the following properties are needed additionally:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Additional properties for PostgreSql/MongoDb support at runtime</span><a class="headerlink" href="#id8" title="Link to this code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getConfigOverrides</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Map</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">ResourcesConstants</span><span class="p">.</span><span class="na">QUARKUS_DEVSERVICES_ENABLED</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="c1">// Specify false for Mnngo, True for Postgre</span>
<span class="w">      </span><span class="n">ResourcesConstants</span><span class="p">.</span><span class="na">QUARKUS_HIBERNATE_ORM_ENABLED</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="c1">// Specify MONGO for Mnngo, POSTGRE for Postgre</span>
<span class="w">      </span><span class="n">ResourcesConstants</span><span class="p">.</span><span class="na">CCS_DB_TYPE</span><span class="p">,</span><span class="w"> </span><span class="n">ResourcesConstants</span><span class="p">.</span><span class="na">MONGO</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>In Production configuration, the same 2 properties are to be setup:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Additional properties for PostgreSql/MongoDb support at runtime</span><a class="headerlink" href="#id9" title="Link to this code">¶</a></div>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">quarkus.hibernate-orm.enabled</span><span class="o">=</span><span class="w"> </span><span class="s">false / true</span>
<span class="na">ccs.db.type</span><span class="o">=</span><span class="s">mongo / postgre</span>
</pre></div>
</div>
</div>
</section>
<section id="in-the-test-classes">
<h5><span class="section-number">8.2.1.2.1.4. </span>In the test classes<a class="headerlink" href="#in-the-test-classes" title="Link to this heading">¶</a></h5>
<p>The 2 first examples are about testing in Test mode (not IT) without any container launched.</p>
<p>First example is about using no Container in the test: Class Test name can be without IT but as <code class="docutils literal notranslate"><span class="pre">XxxTest</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Example of usage of <strong>NoResource</strong> for No container in a test</span><a class="headerlink" href="#id10" title="Link to this code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Do not use @QuarkusIntegrationTest</span>
<span class="nd">@QuarkusTest</span>
<span class="nd">@TestProfile</span><span class="p">(</span><span class="n">NoResourceProfile</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DriverS3NoS3ConfiguredTest</span><span class="w"> </span><span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Second example is the same, without any container, but without using the <strong>NoResourceProfile.class</strong>. This will probably
generate some warn log about non available services, but they should not be harmful.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Example without usage of <strong>NoResource</strong> in a test</span><a class="headerlink" href="#id11" title="Link to this code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Do not use @QuarkusIntegrationTest</span>
<span class="nd">@QuarkusTest</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DriverS3NoS3ConfiguredTest</span><span class="w"> </span><span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Third example is about using a Container in the test: Class Test name must end with IT as <code class="docutils literal notranslate"><span class="pre">XxxIT</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Example of usage of <strong>MinioProfile</strong> for Minio S3 container in a test</span><a class="headerlink" href="#id12" title="Link to this code">¶</a></div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Do not use @QuarkusIntegrationTest</span>
<span class="nd">@QuarkusTest</span>
<span class="c1">// Define Minio Profile</span>
<span class="nd">@TestProfile</span><span class="p">(</span><span class="n">MinioProfile</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DriverS3MinioIT</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DriverS3Base</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@BeforeAll</span>
<span class="w">  </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Example: usage of MinioResource to setup the parameters that should be loaded from properties in normal code</span>
<span class="w">    </span><span class="n">StgDriverS3Properties</span><span class="p">.</span><span class="na">setDynamicS3Parameters</span><span class="p">(</span><span class="n">MinIoResource</span><span class="p">.</span><span class="na">getUrlString</span><span class="p">(),</span><span class="w"> </span><span class="n">MinIoResource</span><span class="p">.</span><span class="na">getAccessKey</span><span class="p">(),</span>
<span class="w">        </span><span class="n">MinIoResource</span><span class="p">.</span><span class="na">getSecretKey</span><span class="p">(),</span><span class="w"> </span><span class="n">MinIoResource</span><span class="p">.</span><span class="na">getRegion</span><span class="p">());</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, Frederic Bregier.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/Dev/Build.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>