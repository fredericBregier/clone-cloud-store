<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.2. Reconciliator’s Algorithm &#8212; Clone Cloud Store [CCS] 0.8 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=472322c9" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <script src="../_static/documentation_options.js?v=f82dc3d9"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.3. Configuration" href="Configuration.html" />
    <link rel="prev" title="4.1. BPMN for Reconciliator" href="BPMN.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Architecture/index.html">1. Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Accessor/index.html">2. Accessor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Replicator/index.html">3. Replicator</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. Reconciliator</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="BPMN.html">4.1. BPMN for Reconciliator</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.2. Reconciliator’s Algorithm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#recurrent-purge">4.2.1. Recurrent purge</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reconciliation">4.2.2. Reconciliation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#clean-step">4.2.2.1. Clean step</a></li>
<li class="toctree-l4"><a class="reference internal" href="#snapshot-step">4.2.2.2. Snapshot step</a></li>
<li class="toctree-l4"><a class="reference internal" href="#local-reconciliation-step">4.2.2.3. Local Reconciliation step</a></li>
<li class="toctree-l4"><a class="reference internal" href="#final-reconciliation-step">4.2.2.4. Final Reconciliation step</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#special-reconciliation-modes">4.2.3. Special Reconciliation modes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initialization-from-existing-object-storage-without-ccs">4.2.3.1. Initialization from existing Object Storage without CCS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pra-reinitialization-or-new-site-initialization">4.2.3.2. PRA reinitialization or new site initialization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Configuration.html">4.3. Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="OpenAPI.html">4.4. Open API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Administration/index.html">5. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">6. Object Storage Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common/index.html">7. Commons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Dev/index.html">8. Dev Detail</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html"><span class="section-number">4. </span>Reconciliator</a><ul>
      <li>Previous: <a href="BPMN.html" title="previous chapter"><span class="section-number">4.1. </span>BPMN for Reconciliator</a></li>
      <li>Next: <a href="Configuration.html" title="next chapter"><span class="section-number">4.3. </span>Configuration</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="reconciliator-s-algorithm">
<h1><span class="section-number">4.2. </span>Reconciliator’s Algorithm<a class="headerlink" href="#reconciliator-s-algorithm" title="Link to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Still in progress</p>
</div>
<section id="recurrent-purge">
<h2><span class="section-number">4.2.1. </span>Recurrent purge<a class="headerlink" href="#recurrent-purge" title="Link to this heading">¶</a></h2>
<p>From time to time, the recurrent purge is there to clean up the database:</p>
<ul class="simple">
<li><p>Purge a “Deleted” object (really deleted) once the “expiry” date is over</p></li>
<li><p>Once the object reached its expiry date:</p>
<ul>
<li><p>Possibly moving it to a dedicated Bucket for archiving with possible new Expiry date</p>
<ul>
<li><p>If archival is enabled, only one bucket is dedicated to archival process per client</p></li>
<li><p>Archival is only valid for object with a valid Driver Object</p></li>
</ul>
</li>
<li><p>Or run “Delete” operation, setting a new “Expiry” date for later on purge</p></li>
<li><p>In all case, send a message to replicate the deletion order to other sites</p></li>
</ul>
</li>
</ul>
<p>Those actions should not be done during reconciliation process but at least before.</p>
<table class="docutils align-center" id="id1">
<caption><span class="caption-text">Recurrent Purge on Expired date</span><a class="headerlink" href="#id1" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>Ready</p></th>
<th class="head"><p>Deleted</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td></td>
<td><p>Once expired</p></td>
</tr>
<tr class="row-odd"><td><p>Object DB</p></td>
<td></td>
<td><p>x</p></td>
</tr>
<tr class="row-even"><td><p>Object Fix</p></td>
<td></td>
<td><p>Purge (check Driver)</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Once expired</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object DB</p></td>
<td><p>x</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Object Fix</p></td>
<td><p>Archive (Move to another Bucket if enabled and exists) or Delete</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="reconciliation">
<h2><span class="section-number">4.2.2. </span>Reconciliation<a class="headerlink" href="#reconciliation" title="Link to this heading">¶</a></h2>
<p>Local Reconciliation is in several steps:</p>
<ul class="simple">
<li><p>Clean step on Objects and Native local objects status according to Request filter</p></li>
<li><p>Start a new Native local objects for Request, from previous run if any</p></li>
<li><p>Snapshot: Fill or Update Native local objects according to Request filter using Objects database</p></li>
<li><p>Snapshot: Fill or Update Native local objects according to Request filter using Driver contents (probable longest duration)</p></li>
<li><p>Create Site Listing from Native local objects and update if necessary Objects accordingly</p></li>
<li><p>Get Site Listing for remote Reconciliation site, the one that starts this reconciliation process</p></li>
</ul>
<p>Optional steps for Local Reconciliation:</p>
<ul class="simple">
<li><p>Clean Native local objects if not to be kept for later use</p></li>
<li><p>Once validate remotely, Clean local Site Listing if not to be kept for later use</p></li>
</ul>
<p>On site where this process is started:</p>
<ul class="simple">
<li><p>Create the Request context</p></li>
<li><p>Send order of local reconciliation process on each remote site and itself</p></li>
<li><p>For each remote site, get the remote Site Listing to append to the local therefore global Site Listing</p></li>
<li><p>Final Reconciliation step</p></li>
</ul>
<p>Final Reconciliation steps:</p>
<ul class="simple">
<li><p>For all entries in Global Site Listing:</p>
<ul>
<li><p>Compute Site Action for All sites / Partial sites context</p></li>
</ul>
</li>
<li><p>For all Site Actions, transfer replication order accordingly to each site, even itself</p>
<ul>
<li><p>Sites having READY ACTION will be considered as remote source site for other sites</p></li>
</ul>
</li>
<li><p>Once all transferred, clean Site Actions</p></li>
<li><p>Statistics update using previous steps</p></li>
</ul>
<p>Then reconciliation corrections happen using standard replication order, using special status to act according to the needs:</p>
<ul class="simple">
<li><p>DELETE ACTION: will delete if possible MD and Driver or both</p></li>
<li><p>UPDATE ACTION: will update Object only from remote site, Driver being ready</p></li>
<li><p>UPLOAD ACTION: will update Driver (content) and possibly Object (some metadata) from remote site</p></li>
</ul>
<section id="clean-step">
<h3><span class="section-number">4.2.2.1. </span>Clean step<a class="headerlink" href="#clean-step" title="Link to this heading">¶</a></h3>
<p>Clean step is several sub-steps: on Objects and Native local objects status according to Request filter</p>
<ul class="simple">
<li><p>All Unknown status Objects and Native local objects are removed</p></li>
<li><p>Update Objects reconciliation status from UPLOAD/ERR_UPL to TO_UPDATE</p></li>
<li><p>Update Objects reconciliation status from DELETING/ERR_DEL to DELETING</p></li>
<li><p>Update Objects reconciliation status from READY or DELETED to respectively the same</p></li>
<li><p>Purge Native local objects with status UNKNOWN, UPLOAD, ERR_UPL, DELETED or ERR_DEL</p></li>
</ul>
<table class="docutils align-center" id="id2">
<caption><span class="caption-text">Pre Reconciliation Purge</span><a class="headerlink" href="#id2" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>Unknown</p></th>
<th class="head"><p>Upload</p></th>
<th class="head"><p>Ready</p></th>
<th class="head"><p>Err Upl</p></th>
<th class="head"><p>Deleting</p></th>
<th class="head"><p>Deleted</p></th>
<th class="head"><p>Err Del</p></th>
<th class="head"><p>To Update</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Purge</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object DB</p></td>
<td><p>x</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Object Fix</p></td>
<td><p>Delete</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Purge</p></td>
<td><p>status</p></td>
<td><p>older</p></td>
<td><p>than</p></td>
<td><p>reference</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object DB</p></td>
<td></td>
<td><p>x</p></td>
<td></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td></td>
<td><p>x</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Object R Status</p></td>
<td></td>
<td><p>To Update</p></td>
<td><p>X</p></td>
<td><p>To Update</p></td>
<td><p>Deleting</p></td>
<td><p>X</p></td>
<td><p>Deleting</p></td>
<td></td>
</tr>
</tbody>
</table>
<table class="docutils align-center" id="id3">
<caption><span class="caption-text">Pre Result Reconciliation Purge</span><a class="headerlink" href="#id3" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>Unknown</p></th>
<th class="head"><p>Upload</p></th>
<th class="head"><p>Ready</p></th>
<th class="head"><p>Err Upl</p></th>
<th class="head"><p>Deleting</p></th>
<th class="head"><p>Deleted</p></th>
<th class="head"><p>Err Del</p></th>
<th class="head"><p>To Update</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Previous Result</p></td>
<td></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
</tr>
<tr class="row-odd"><td><p>Fixed Result</p></td>
<td><p>Removed</p></td>
<td><p>Removed</p></td>
<td><p>x</p></td>
<td><p>Removed</p></td>
<td><p>x</p></td>
<td><p>Removed</p></td>
<td><p>Removed</p></td>
<td><p>x</p></td>
</tr>
</tbody>
</table>
</section>
<section id="snapshot-step">
<h3><span class="section-number">4.2.2.2. </span>Snapshot step<a class="headerlink" href="#snapshot-step" title="Link to this heading">¶</a></h3>
<p>Two steps are concerned:</p>
<ul class="simple">
<li><p>Fill or Update Native local objects according to Request filter using Objects database</p>
<ul>
<li><p>If the reconciliation status is a “delete” status, the driver part is ignored</p></li>
</ul>
</li>
<li><p>Fill or Update Native local objects according to Request filter using Driver contents (probable longest duration)</p>
<ul>
<li><p>Will add or update the Driver part</p></li>
</ul>
</li>
</ul>
<table class="docutils align-center" id="id4">
<caption><span class="caption-text">Load from DB and Driver</span><a class="headerlink" href="#id4" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>Unknown</p></th>
<th class="head"><p>Upload</p></th>
<th class="head"><p>Ready</p></th>
<th class="head"><p>Err Upl</p></th>
<th class="head"><p>Deleting</p></th>
<th class="head"><p>Deleted</p></th>
<th class="head"><p>Err Del</p></th>
<th class="head"><p>To Update</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>From DB</p></td>
<td></td>
<td></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
</tr>
<tr class="row-odd"><td><p>From Driver</p></td>
<td></td>
<td></td>
<td><p>x</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="local-reconciliation-step">
<h3><span class="section-number">4.2.2.3. </span>Local Reconciliation step<a class="headerlink" href="#local-reconciliation-step" title="Link to this heading">¶</a></h3>
<p>Create Site Listing from Native local objects and update if necessary Objects accordingly:</p>
<ul class="simple">
<li><p>From Driver only, consider Object shall be READY and To Update</p>
<ul>
<li><p>Create missing Object with existing metadata from Driver (possibly some missing)</p></li>
</ul>
</li>
<li><p>From Db only, consider Delete like as Deleted, and others (Object shall exist) as To Upload again</p>
<ul>
<li><p>Update Objects accordingly</p></li>
</ul>
</li>
<li><p>From both, consider Delete like as To Delete, and others (Object present but not ready except READY ones) as To Update (metadata only)</p>
<ul>
<li><p>Update Objects accordingly</p></li>
</ul>
</li>
</ul>
<table class="docutils align-center" id="id5">
<caption><span class="caption-text">Fix LocalSite Reconciliation: Driver present, DB absent</span><a class="headerlink" href="#id5" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>Unknown</p></th>
<th class="head"><p>Upload</p></th>
<th class="head"><p>Ready</p></th>
<th class="head"><p>Err Upl</p></th>
<th class="head"><p>Deleting</p></th>
<th class="head"><p>Deleted</p></th>
<th class="head"><p>Err Del</p></th>
<th class="head"><p>To Update</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Source Sites</p></td>
<td></td>
<td></td>
<td><p>x</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object Fix</p></td>
<td></td>
<td></td>
<td><p>X (new one)</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>+X</p></td>
</tr>
<tr class="row-even"><td><p>Updated Sites</p></td>
<td></td>
<td></td>
<td><p>Update</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Once done, the to update ones will be update from the Driver and set as Ready.</p>
<table class="docutils align-center" id="id6">
<caption><span class="caption-text">Fix LocalSite Reconciliation: DB present, Driver absent with Available like status</span><a class="headerlink" href="#id6" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>Unknown</p></th>
<th class="head"><p>Upload</p></th>
<th class="head"><p>Ready</p></th>
<th class="head"><p>Err Upl</p></th>
<th class="head"><p>Deleting</p></th>
<th class="head"><p>Deleted</p></th>
<th class="head"><p>Err Del</p></th>
<th class="head"><p>To Update</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Sites</p></td>
<td></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td></td>
<td></td>
<td></td>
<td><p>x</p></td>
</tr>
<tr class="row-odd"><td><p>Object Fix</p></td>
<td></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>+X</p></td>
</tr>
<tr class="row-even"><td><p>Fix Sites</p></td>
<td></td>
<td><p>Upload</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table class="docutils align-center" id="id7">
<caption><span class="caption-text">Fix LocalSite Reconciliation: DB present, Driver absent with Delete like status</span><a class="headerlink" href="#id7" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>Unknown</p></th>
<th class="head"><p>Upload</p></th>
<th class="head"><p>Ready</p></th>
<th class="head"><p>Err Upl</p></th>
<th class="head"><p>Deleting</p></th>
<th class="head"><p>Deleted</p></th>
<th class="head"><p>Err Del</p></th>
<th class="head"><p>To Update</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Sites</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object Fix</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Fix Sites</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Delete</p></td>
<td><p>Deleted</p></td>
<td><p>Delete</p></td>
<td></td>
</tr>
</tbody>
</table>
<table class="docutils align-center" id="id8">
<caption><span class="caption-text">Fix LocalSite Reconciliation: DB and Driver presents with Ready like status</span><a class="headerlink" href="#id8" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>Unknown</p></th>
<th class="head"><p>Upload</p></th>
<th class="head"><p>Ready</p></th>
<th class="head"><p>Err Upl</p></th>
<th class="head"><p>Deleting</p></th>
<th class="head"><p>Deleted</p></th>
<th class="head"><p>Err Del</p></th>
<th class="head"><p>To Update</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Object DB</p></td>
<td></td>
<td><p>x</p></td>
<td></td>
<td><p>x</p></td>
<td></td>
<td></td>
<td></td>
<td><p>x</p></td>
</tr>
<tr class="row-odd"><td><p>Object Driver</p></td>
<td></td>
<td></td>
<td><p>x</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Object Fix</p></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>X</p></td>
</tr>
<tr class="row-odd"><td><p>Sites Fix</p></td>
<td></td>
<td><p>Update</p></td>
<td></td>
<td><p>Update</p></td>
<td></td>
<td></td>
<td></td>
<td><p>Update</p></td>
</tr>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object DB</p></td>
<td></td>
<td></td>
<td><p>x</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Object Driver</p></td>
<td></td>
<td></td>
<td><p>x</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Sites Fix</p></td>
<td></td>
<td></td>
<td><p>Ready</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Once done, the to update ones will be update from the Driver and set as Ready.</p>
<table class="docutils align-center" id="id9">
<caption><span class="caption-text">Fix LocalSite Site Reconciliation: DB and Driver with Delete like status</span><a class="headerlink" href="#id9" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>Unknown</p></th>
<th class="head"><p>Upload</p></th>
<th class="head"><p>Ready</p></th>
<th class="head"><p>Err Upl</p></th>
<th class="head"><p>Deleting</p></th>
<th class="head"><p>Deleted</p></th>
<th class="head"><p>Err Del</p></th>
<th class="head"><p>To Update</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Object DB</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object Driver</p></td>
<td></td>
<td></td>
<td><p>x</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Object Fix</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Sites Fix</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p>Delete</p></td>
<td><p>Delete</p></td>
<td><p>Delete</p></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="final-reconciliation-step">
<h3><span class="section-number">4.2.2.4. </span>Final Reconciliation step<a class="headerlink" href="#final-reconciliation-step" title="Link to this heading">¶</a></h3>
<p>From all remote Reconciliation site listing, Actions are sorted according to descending event dates, the latest being
the primary event.</p>
<p>Thr order of actions is: DELETE &gt; READY &gt; UPDATE &gt; UPLOAD</p>
<p>So for instance:</p>
<ul class="simple">
<li><p>latest event: DELETE like and anything else</p>
<ul>
<li><p>=&gt; DELETE everywhere</p></li>
</ul>
</li>
<li><p>latest event: READY like (UPDATE/UPLOAD)</p>
<ul>
<li><p>=&gt; UPDATE or UPLOAD from READY site(s) (potentially multiples sources)</p></li>
<li><p>Special case: if none are READY, UPDATE ones will changed to READY</p></li>
<li><p>Special case latest event: all UPLOAD status (no READY or UPDATE)</p>
<ul>
<li><p>These final cases are in big trouble since there is no more available correct information</p>
<ul>
<li><p>UPLOAD cannot be fixed if there is no source at all =&gt; changed to ERROR_ACTION with no source to get ERR_UPL status</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Two cases have to be checked: all sites or subset of sites are referenced for each item:</p>
<ul class="simple">
<li><p>One entry has all sites referenced: so all know about it</p></li>
<li><p>One entry has a subset of all sites referenced: therefore, except for delete action where they are ignored,
they should be considered as an UPLOAD action (for UPDATE, the concerned site will upgrade locally to UPLOAD since
no object present)</p></li>
</ul>
<p>Those 2 cases are fusion in one:</p>
<ul class="simple">
<li><p>For all Site Actions, transfer replication order accordingly to each site, even itself</p>
<ul>
<li><p>Sites having READY/UPDATE ACTION will be considered as remote source site for other sites</p></li>
</ul>
</li>
</ul>
<table class="docutils align-center" id="id10">
<caption><span class="caption-text">Compute Remote Site Action Reconciliation</span><a class="headerlink" href="#id10" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>From</p></th>
<th class="head"><p>DELETED</p></th>
<th class="head"><p>DELETE</p></th>
<th class="head"><p>READY</p></th>
<th class="head"><p>UPDATE</p></th>
<th class="head"><p>UPLOAD</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Primary</p></td>
<td><p><strong>X</strong></p></td>
<td><p><strong>X</strong></p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Other</p></td>
<td><p>°</p></td>
<td><p>°</p></td>
<td><p>°</p></td>
<td><p>°</p></td>
<td><p>°</p></td>
</tr>
<tr class="row-even"><td><p>Actions</p></td>
<td><p>DEL</p></td>
<td></td>
<td><p>DEL</p></td>
<td><p>DEL</p></td>
<td><p>DEL</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Primary</p></td>
<td></td>
<td></td>
<td><p><strong>X</strong></p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Other</p></td>
<td><p>°</p></td>
<td><p>°</p></td>
<td><p>1</p></td>
<td><p>°</p></td>
<td><p>°</p></td>
</tr>
<tr class="row-even"><td><p>Actions</p></td>
<td><p>UPL from (1)X</p></td>
<td><p>UPL from (1)X</p></td>
<td></td>
<td><p>UPD from (1)X</p></td>
<td><p>UPL from (1)X</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Primary</p></td>
<td></td>
<td></td>
<td></td>
<td><p><strong>X</strong></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Other</p></td>
<td><p>°</p></td>
<td><p>°</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>°</p></td>
</tr>
<tr class="row-even"><td><p>Actions</p></td>
<td><p>UPL from (1) <em>xor</em> from (2X)</p></td>
<td><p>UPL from (1) <em>xor</em> from (2X)</p></td>
<td></td>
<td><p>UPD from (1) <em>xor</em> UPG(2)</p></td>
<td><p>UPL from (1) <em>xor</em> from (2X)</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Primary</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p><strong>X</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Other</p></td>
<td><p>°</p></td>
<td><p>°</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>°</p></td>
</tr>
<tr class="row-even"><td><p>Actions</p></td>
<td><p>UPL from (1) <em>xor</em> from (2)</p></td>
<td><p>UPL from (1) <em>xor</em> from (2)</p></td>
<td></td>
<td><p>UPD from (1) <em>xor</em> UPG(2)</p></td>
<td><p>UPL from (1) <em>xor</em> from (2)</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Primary</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><p><strong>X</strong></p></td>
</tr>
<tr class="row-odd"><td><p>Other</p></td>
<td><p>°</p></td>
<td><p>°</p></td>
<td></td>
<td></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>Actions</p></td>
<td><p><em>invalid</em></p></td>
<td><p><em>invalid</em></p></td>
<td><p><em>invalid</em></p></td>
<td><p><em>invalid</em></p></td>
<td><p>ERROR</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Transfer replication order and application not yet implemented</p>
</div>
<table class="docutils align-center" id="id11">
<caption><span class="caption-text">Remote Site Action final Reconciliation</span><a class="headerlink" href="#id11" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Object DB</p></th>
<th class="head"><p>UPLOAD</p></th>
<th class="head"><p>READY</p></th>
<th class="head"><p>ERR_UPL</p></th>
<th class="head"><p>DELETING</p></th>
<th class="head"><p>DELETED</p></th>
<th class="head"><p>ERR_DEL</p></th>
<th class="head"><p>ABSENT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Actions</p></td>
<td><p><strong>DELETE</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object DB Fix</p></td>
<td><p>DELETED</p></td>
<td><p>DELETED</p></td>
<td><p>DELETED</p></td>
<td><p>DELETED</p></td>
<td><p><em>invalid</em></p></td>
<td><p>DELETED</p></td>
<td><p><em>ignore</em></p></td>
</tr>
<tr class="row-even"><td><p>Driver Fix</p></td>
<td><p>DELETE if exists</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Actions</p></td>
<td><p><strong>UPDATE</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object DB Fix</p></td>
<td><p>READY If Driver</p></td>
<td><p>READY If Driver</p></td>
<td><p>READY If Driver</p></td>
<td><p><em>invalid</em></p></td>
<td><p><em>invalid</em></p></td>
<td><p><em>invalid</em></p></td>
<td><p>READY with upload</p></td>
</tr>
<tr class="row-even"><td><p>Driver Fix</p></td>
<td><p>Upload if needed</p></td>
<td><p><em>invalid</em></p></td>
<td><p>Upload if needed</p></td>
<td></td>
<td></td>
<td></td>
<td><p>Upload</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Actions</p></td>
<td><p><strong>UPLOAD</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object DB Fix</p></td>
<td><p>READY</p></td>
<td><p><em>invalid</em></p></td>
<td><p>READY</p></td>
<td><p>READY</p></td>
<td><p>READY</p></td>
<td><p>READY</p></td>
<td><p>READY</p></td>
</tr>
<tr class="row-even"><td><p>Driver Fix</p></td>
<td><p>Upload</p></td>
<td><p><em>invalid</em></p></td>
<td><p>Upload</p></td>
<td><p>Upload</p></td>
<td><p>Upload</p></td>
<td><p>Upload</p></td>
<td><p>Upload</p></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Actions</p></td>
<td><p><strong>UPGRADE</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object DB Fix</p></td>
<td><p>READY</p></td>
<td><p><em>invalid</em></p></td>
<td><p>READY</p></td>
<td><p>READY</p></td>
<td><p>READY</p></td>
<td><p>READY</p></td>
<td><p>READY</p></td>
</tr>
<tr class="row-even"><td><p>Driver Fix</p></td>
<td><p>Upload if needed</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Actions</p></td>
<td><p><strong>ERR_UPL</strong></p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Object DB Fix</p></td>
<td><p>ERR_UPL</p></td>
<td><p><em>invalid</em></p></td>
<td><p>ERR_UPL</p></td>
<td><p><em>invalid</em></p></td>
<td><p><em>invalid</em></p></td>
<td><p><em>invalid</em></p></td>
<td><p><em>invalid</em></p></td>
</tr>
<tr class="row-even"><td><p>Driver Fix</p></td>
<td><p>Nothing</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="special-reconciliation-modes">
<h2><span class="section-number">4.2.3. </span>Special Reconciliation modes<a class="headerlink" href="#special-reconciliation-modes" title="Link to this heading">¶</a></h2>
<p>Two special cases are implemented:</p>
<ul class="simple">
<li><p>Initialization from existing object in Driver Storage while CCS was not yet used to create them</p></li>
<li><p>Initialization for a new site (whatever really new one or disaster one so almost new), in order to speed up
reconciliation step for this new site from an existing site</p></li>
</ul>
<section id="initialization-from-existing-object-storage-without-ccs">
<h3><span class="section-number">4.2.3.1. </span>Initialization from existing Object Storage without CCS<a class="headerlink" href="#initialization-from-existing-object-storage-without-ccs" title="Link to this heading">¶</a></h3>
<p>When moving an existing application with existing Objects to Cloud Clone Store, one could use the following batch:</p>
<ul class="simple">
<li><p>From Storage Driver, initialize Objects and Buckets in database according to arguments</p>
<ul>
<li><p>Arguments such as: bucket name, client Id to use, common specific metadata</p></li>
</ul>
</li>
</ul>
<p>Note that the issue right now identified is that Bucket are named using clientId within CCS.
To enable such an import, a special attention should be done on this case (where bucket does not have ClientId in
its final name).</p>
<p>All items will have READY status.</p>
</section>
<section id="pra-reinitialization-or-new-site-initialization">
<h3><span class="section-number">4.2.3.2. </span>PRA reinitialization or new site initialization<a class="headerlink" href="#pra-reinitialization-or-new-site-initialization" title="Link to this heading">¶</a></h3>
<p>When a site has a disaster (partial or full disaster) or when a new site is added to an existing multi-sites CCS
configuration, there is a special batch to resume the CCS database and Cloud Storage contents.</p>
<p>Once the CCS is installed (or reinstalled), instead of running a standard Reconciliation, one can run this specific
Reconciliation from existing (or none) status on the new/rebuild site.</p>
<ul class="simple">
<li><p>Mode empty site: no objets neither storage objects in the site to synchronize</p>
<ul>
<li><p>This mode is optimize for “all” synchro mode with no control on destination site since nothing is there</p></li>
<li><p>ALl items will have READY Status using UPLOAD_ACTION from given existing sites</p></li>
</ul>
</li>
<li><p>Mode disaster recovery: objects or storage objects can exist, partially</p>
<ul>
<li><p>This mode is optimize for “all” synchro mode with control on destination site since objects or storage objects or
both can exist</p></li>
<li><p>ALl items will have READY Status using UPGRADE_ACTION from given existing sites</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, Frederic Bregier.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/Reconciliator/algorithm.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>